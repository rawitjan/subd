# **1. База данных для книжного магазина** 
**Цель**: Хранение информации о книгах, авторах, клиентах и продажах.

**Таблицы:**
`authors` -- авторы
1. id
2. name
3. birth_date
4. nationality
5. biography

`customers` -- клиенты
1. id
2. name
3. email
4. phone
5. address
6. registration_date -- дата регистраций

`genres` 
1. id
2. name
3. description

`publishers` 
 1. id, 
 2. name, 
 3. country, 
 4. foundation_year, 
 5. website

`orders`  -- заказы
1. id , 
2. customer_id -- аиди клиента 
3. order_date  -- дата заказа
4. total_price
5. status
6. payment_method

`order_items` 
1. id
2. order_id
3. book_id
4. quantity -- кол-во
5. price
6. discount -- скидка

`books` 
1. id
2. title
3. author_id
4. genre_id
5. publisher_id
6. price
7. stock -- кол-во экземпляров
8. publication_year
9. isbn

`reviews` 
1. id
2. book_id
3. customer_id
4. rating
5. comment
6. review_date
7. verified_purchase
---
Данные 
```sql
INSERT INTO authors (id, name, birth_date, nationality, biography) VALUES
(1, 'J.K. Rowling', '1965-07-31', 'UK', 'Author of the Harry Potter series'),
(2, 'George R.R. Martin', '1948-09-20', 'USA', 'Author of A Song of Ice and Fire'),
(3, 'Stephen King', '1947-09-21', 'USA', 'Master of horror novels'),
(4, 'Agatha Christie', '1890-09-15', 'UK', 'Queen of detective fiction'),
(5, 'Haruki Murakami', '1949-01-12', 'Japan', 'Famous for surrealistic storytelling'),
(6, 'Ілияс Есенберлин', '1915-01-10', 'Kazakhstan', 'Тарихи романдар авторы'),
(7, 'Мұхтар Әуезов', '1897-09-28', 'Kazakhstan', '"Абай жолы" романының авторы'),
(8, 'Дулат Исабеков', '1942-10-20', 'Kazakhstan', 'Қазақ әдебиетінің классигі'),
(9, 'Айгүл Кемелбаева', '1965-05-10', 'Kazakhstan', 'Қазақ жазушысы, философиялық прозаның өкілі'),
(10, 'Чингиз Айтматов', '1928-12-12', 'Kyrgyzstan', 'Танымал қырғыз жазушысы'),
(11, 'Ernest Hemingway', '1899-07-21', 'USA', 'Famous for minimalistic writing'),
(12, 'Paulo Coelho', '1947-08-24', 'Brazil', 'Author of "The Alchemist"'),
(13, 'Orhan Pamuk', '1952-06-07', 'Turkey', 'Nobel laureate, Istanbul stories'),
(14, 'Қалихан Ысқақ', '1935-04-15', 'Kazakhstan', 'Қазақ прозасының шебері'),
(15, 'Gabriel García Márquez', '1927-03-06', 'Colombia', 'Magical realism master'),
(16, 'Сәбит Мұқанов', '1900-05-13', 'Kazakhstan', 'Ақын, жазушы, қоғам қайраткері');


INSERT INTO customers (id, name, email, phone, address, registration_date) VALUES
(1, 'Alice Johnson', 'alice@example.com', '+1234567890', '123 Elm St', '2023-01-15'),
(2, 'Bob Smith', 'bob@example.com', '+1234567891', '456 Oak St', '2023-02-20'),
(3, 'Clara Lee', 'clara@example.com', '+1234567892', '789 Pine St', '2023-03-12'),
(4, 'Айгүл Сұлтан', 'aigul@example.kz', '+77011234567', 'Алматы, Төле би көшесі 15', '2023-05-10'),
(5, 'Нұржан Темір', 'nurzhan@example.kz', '+77029876543', 'Астана, Абылай хан 22', '2023-06-01'),
(6, 'Бақытжан Әлібек', 'bakyt@example.kz', '+77013425678', 'Шымкент, Түркістан 17', '2023-07-04'),
(7, 'Талғат Мусин', 'talgat@example.kz', '+77014567890', 'Қарағанды, Ермеков 3', '2023-08-10'),
(8, 'Жанна Қайрат', 'zhanna@example.kz', '+77019998888', 'Тараз, Айша бибі көшесі 5', '2023-08-13'),
(9, 'Timur Yessentayev', 'timur@example.kz', '+77015551234', 'Атырау, Сатпаев 12', '2023-08-16'),
(10, 'Айдана Төлеу', 'aidana@example.kz', '+77012223344', 'Көкшетау, Әуезов көшесі 20', '2023-08-20');


INSERT INTO publishers (id, name, country, foundation_year, website) VALUES
(1, 'Bloomsbury', 'UK', 1986, 'https://bloomsbury.com'),
(2, 'Bantam Books', 'USA', 1945, 'https://bantambooks.com'),
(3, 'Scribner', 'USA', 1846, 'https://scribner.com'),
(4, 'Shinchōsha', 'Japan', 1896, 'https://shinchosha.co.jp'),
(5, 'Фолиант', 'Kazakhstan', 1996, 'https://foliant.kz'),
(6, 'Атамұра', 'Kazakhstan', 1990, 'https://atamura.kz');


INSERT INTO genres (id, name, description) VALUES
(1, 'Fantasy', 'Magical and imaginary worlds'),
(2, 'Horror', 'Fiction intended to scare'),
(3, 'Mystery', 'Crime and detective stories'),
(4, 'Drama', 'Emotion-driven narratives'),
(5, 'Тарихи роман', 'Қазақ тарихына арналған көркем шығармалар'),
(6, 'Әдеби проза', 'Көркем прозалық туындылар');


INSERT INTO books (id, title, author_id, genre_id, publisher_id, price, stock, publication_year, isbn) VALUES
(1, 'Harry Potter and the Philosopher''s Stone', 1, 1, 1, 2500.99, 50, 1997, '9780747532699'),
(2, 'A Game of Thrones', 2, 1, 2, 1900.99, 35, 1996, '9780553103540'),
(3, 'The Shining', 3, 2, 3, 1900.99, 20, 1977, '9780385121675'),
(4, 'Murder on the Orient Express', 4, 3, 3, 17.75, 40, 1934, '9780007119318'),
(5, 'Norwegian Wood', 5, 4, 4, 2200.50, 15, 1987, '9780375704024'),
(6, 'Абай жолы', 7, 6, 6, 1800.50, 60, 1942, '9786013020123'),
(7, 'Қаһар', 6, 5, 5, 2000.00, 45, 1969, '9786012940033'),
(8, 'Гауһартас', 8, 6, 5, 1600.90, 30, 1970, '9786012930768');
(9, 'Жан Парасат', 9, 6, 5, 1700.00, 20, 2015, '9786013333453'),
(10, 'Жәмилә', 10, 6, 5, 1600.50, 25, 1958, '9786012345123'),
(11, 'The Old Man and the Sea', 11, 4, 3, 1500.90, 18, 1952, '9780684801223'),
(12, 'The Alchemist', 12, 4, 3, 2100.00, 30, 1988, '9780061122415'),
(13, 'My Name is Red', 13, 4, 6, 2200.70, 12, 2001, '9780375706851'),
(14, 'Тар жол, тайғақ кешу', 14, 5, 6, 1800.90, 22, 1980, '9786013034565'),
(15, 'One Hundred Years of Solitude', 15, 1, 2, 2400.00, 15, 1967, '9780060883287'),
(16, 'Сырдария', 16, 6, 6, 1700.60, 27, 1950, '9786012752439');


INSERT INTO orders (id, customer_id, order_date, total_price, status, payment_method) VALUES
(1, 1, '2023-08-01', 5100.98, 'completed', 'credit_card'),
(2, 4, '2023-08-05', 2000.00, 'completed', 'cash'),
(3, 5, '2023-08-07', 3600.90, 'pending', 'bank_transfer'),
(4, 2, '2023-08-10', 3200.90, 'completed', 'credit_card'),
(5, 3, '2023-08-11', 4700.90, 'completed', 'cash'),
(6, 6, '2023-08-12', 3300.60, 'pending', 'bank_transfer'),
(7, 8, '2023-08-13', 5500.00, 'completed', 'credit_card');
(8, 4, '2023-09-16', 3187.55, 'pending', 'cash'),
(9, 4, '2023-10-13', 3420.51, 'pending', 'bank_transfer'),
(10, 4, '2023-09-22', 5124.25, 'completed', 'cash'),
(11, 2, '2023-10-12', 3845.47, 'pending', 'bank_transfer'),
(12, 6, '2023-09-08', 2817.03, 'completed', 'bank_transfer'),
(13, 4, '2023-10-05', 4967.76, 'pending', 'bank_transfer'),
(14, 6, '2023-09-10', 4163.41, 'completed', 'bank_transfer'),
(15, 1, '2023-09-22', 4286.18, 'completed', 'credit_card'),
(16, 8, '2023-09-25', 2669.45, 'completed', 'cash'),
(17, 1, '2023-09-07', 5107.18, 'pending', 'cash'),
(18, 9, '2023-08-22', 3731.69, 'completed', 'cash'),
(19, 3, '2023-09-10', 4551.62, 'pending', 'cash'),
(20, 9, '2023-10-07', 5216.73, 'pending', 'cash'),
(21, 5, '2023-09-06', 5551.1, 'pending', 'cash'),
(22, 1, '2023-09-04', 2916.36, 'completed', 'cash'),
(23, 7, '2023-08-19', 5974.03, 'completed', 'credit_card'),
(24, 6, '2023-09-12', 2983.82, 'completed', 'credit_card'),
(25, 1, '2023-10-08', 5666.95, 'cancelled', 'credit_card'),
(26, 3, '2023-10-03', 3920.71, 'cancelled', 'credit_card'),
(27, 7, '2023-08-29', 3892.88, 'cancelled', 'credit_card'),
(28, 3, '2023-10-03', 3795.7, 'cancelled', 'credit_card'),
(29, 7, '2023-09-21', 2553.44, 'cancelled', 'cash'),
(30, 1, '2023-09-26', 4841.13, 'completed', 'credit_card'),
(31, 2, '2023-09-11', 2941.37, 'completed', 'cash'),
(32, 3, '2023-08-21', 1990.98, 'cancelled', 'bank_transfer'),
(33, 8, '2023-10-04', 3074.81, 'cancelled', 'cash'),
(34, 5, '2023-09-08', 3367.68, 'completed', 'cash'),
(35, 5, '2023-10-14', 2732.34, 'completed', 'credit_card'),
(36, 2, '2023-09-26', 3395.61, 'completed', 'credit_card'),
(37, 7, '2023-08-28', 4735.93, 'cancelled', 'bank_transfer');

INSERT INTO order_items (id, order_id, book_id, quantity, price, discount) VALUES
(1, 1, 1, 1, 2500.99, 0),
(2, 1, 2, 1, 2500.99, 0),
(3, 2, 7, 1, 2000.00, 0),
(4, 3, 5, 1, 2200.50, 0),
(5, 3, 8, 1, 1600.90, 200.50);
(6, 4, 10, 1, 1600.50, 0),
(7, 4, 14, 1, 1800.90, 200.50),
(8, 5, 15, 1, 2400.00, 0),
(9, 5, 11, 1, 1500.90, 0),
(10, 6, 13, 1, 2200.70, 0),
(11, 6, 9, 1, 1700.00, 0),
(12, 7, 16, 1, 1700.60, 0),
(13, 7, 12, 1, 2100.00, 100.00),
(14, 17, 9, 2, 2166.17, 3.52),
(15, 23, 9, 1, 2354.68, 1.15),
(16, 32, 12, 2, 2117.33, 3.31),
(17, 31, 3, 3, 2225.49, 4.37),
(18, 6, 2, 1, 1977.38, 3.51),
(19, 13, 5, 3, 2140.08, 1.47),
(20, 25, 9, 2, 2407.35, 0.35),
(21, 15, 4, 2, 2219.07, 0.73),
(22, 10, 4, 1, 1570.66, 0.88),
(23, 34, 2, 1, 2215.34, 3.19),
(24, 25, 1, 2, 2379.11, 1.92),
(25, 30, 10, 2, 1738.57, 0.25),
(26, 27, 2, 3, 1512.59, 3.05),
(27, 15, 2, 1, 2482.17, 2.83),
(28, 36, 14, 3, 1696.42, 4.69),
(29, 9, 9, 1, 1541.24, 4.62),
(30, 36, 2, 2, 2192.62, 4.76),
(31, 21, 6, 2, 2187.29, 3.44),
(32, 23, 7, 3, 1919.77, 1.6),
(33, 21, 12, 2, 2326.19, 1.17),
(34, 21, 6, 3, 1713.11, 2.2),
(35, 19, 14, 1, 2071.98, 1.3),
(36, 4, 15, 1, 1884.22, 2.35),
(37, 28, 11, 3, 2102.83, 4.9),
(38, 9, 9, 1, 2128.9, 0.45),
(39, 36, 3, 2, 1947.02, 1.39),
(40, 21, 5, 1, 1601.08, 1.31),
(41, 8, 2, 3, 1646.81, 0.97),
(42, 17, 3, 1, 1923.77, 2.07),
(43, 9, 13, 3, 2347.93, 3.71),
(44, 33, 13, 1, 2288.87, 1.58),
(45, 36, 13, 2, 2256.37, 2.56),
(46, 34, 15, 2, 2490.09, 1.72),
(47, 3, 10, 2, 2486.24, 2.99),
(48, 10, 4, 1, 2287.72, 0.15),
(49, 33, 12, 3, 1987.99, 1.82),
(50, 17, 10, 2, 1803.15, 4.83),
(51, 17, 6, 2, 2357.02, 0.68),
(52, 10, 5, 3, 1586.24, 0.76),
(53, 30, 4, 1, 1815.1, 0.96),
(54, 6, 1, 3, 1743.33, 2.69),
(55, 24, 2, 1, 2442.12, 2.48),
(56, 1, 8, 1, 2346.99, 4.17),
(57, 15, 6, 1, 1516.57, 3.22),
(58, 28, 10, 2, 2206.94, 2.12),
(59, 11, 16, 2, 2366.54, 2.45),
(60, 4, 3, 1, 1610.08, 3.93),
(61, 16, 3, 1, 2391.0, 0.49),
(62, 1, 12, 3, 2264.59, 1.96),
(63, 12, 4, 2, 2325.99, 200.36),
(64, 37, 6, 2, 2187.3, 740),
(65, 12, 3, 2, 1695.51, 230),
(66, 2, 6, 3, 2107.41, 400.44),
(67, 33, 3, 2, 2104.53, 100.04),
(68, 17, 3, 1, 2088.07, 300.6),
(69, 3, 4, 3, 1796.14, 100.44),
(70, 30, 13, 3, 2100.01, 200),
(71, 14, 10, 2, 2159.65, 400.12),
(72, 11, 8, 2, 2388.18, 100.53),
(73, 16, 13, 1, 1633.44, 300.48);


INSERT INTO reviews (id, book_id, customer_id, rating, comment, review_date, verified_purchase) VALUES
(1, 1, 1, 5, 'Great book, loved it!', '2023-08-10', true),
(2, 7, 4, 4, 'Керемет шығарма, тарихпен үйлескен', '2023-08-12', true),
(3, 5, 5, 5, 'Мазмұнды, терең роман', '2023-08-14', true);
(4, 12, 6, 5, 'Шабыттандырды!', '2023-08-16', true),
(5, 10, 2, 4, 'Терең мазмұнды повесть', '2023-08-17', true),
(6, 16, 3, 5, 'Классика! Қазақ прозасының жауһары', '2023-08-18', true),
(7, 10, 2, 3, 'Fantastic!', '2023-10-26', true),
(8, 11, 5, 5, 'Жақсы кітап', '2023-08-27', false),
(9, 13, 4, 5, 'Great read!', '2023-08-21', false),
(10, 15, 2, 4, 'Жақсы кітап', '2023-11-02', false),
(11, 11, 3, 4, 'Fantastic!', '2023-10-17', false),
(12, 2, 4, 3, 'Great read!', '2023-09-13', false),
(13, 11, 3, 5, 'Тамаша жазылған!', '2023-10-19', true),
(14, 1, 5, 3, 'Жақсы кітап', '2023-10-24', true),
(15, 4, 9, 3, 'Интересная история', '2023-10-12', true),
(16, 4, 1, 3, 'Жақсы кітап', '2023-10-03', true),
(17, 10, 9, 5, 'Fantastic!', '2023-08-21', true),
(18, 3, 10, 5, 'Great read!', '2023-11-16', true),
(19, 5, 9, 3, 'Тамаша жазылған!', '2023-09-24', true),
(20, 12, 5, 5, 'Highly recommended!', '2023-10-25', true),
(21, 13, 3, 4, 'Great read!', '2023-11-04', false),
(22, 14, 6, 4, 'Тамаша жазылған!', '2023-11-03', false),
(23, 14, 8, 4, 'Жақсы кітап', '2023-08-24', true),
(24, 3, 6, 5, 'Highly recommended!', '2023-11-02', true),
(25, 12, 8, 4, 'Керемет туынды!', '2023-09-20', false),
(26, 6, 3, 4, 'Great read!', '2023-10-26', false),
(27, 9, 7, 5, 'Тамаша жазылған!', '2023-11-10', false),
(28, 12, 3, 4, 'Интересная история', '2023-08-25', true),
(29, 14, 2, 5, 'Тамаша жазылған!', '2023-09-21', false),
(30, 2, 2, 4, 'Жақсы кітап', '2023-11-03', true),
(31, 10, 1, 3, 'Highly recommended!', '2023-08-30', false),
(32, 2, 5, 5, 'Керемет туынды!', '2023-09-03', true),
(33, 6, 6, 4, 'Тамаша жазылған!', '2023-10-07', true),
(34, 10, 2, 3, 'Керемет туынды!', '2023-10-16', false),
(35, 3, 5, 5, 'Жақсы кітап', '2023-10-26', false),
(36, 13, 8, 3, 'Highly recommended!', '2023-09-03', false),
(37, 9, 4, 4, 'Жақсы кітап', '2023-09-06', false),
(38, 10, 4, 5, 'Fantastic!', '2023-10-01', false),
(39, 15, 6, 4, 'Fantastic!', '2023-10-12', false),
(40, 4, 9, 4, 'Керемет туынды!', '2023-09-06', true),
(41, 3, 10, 3, 'Керемет туынды!', '2023-09-29', true),
(42, 4, 7, 5, 'Great read!', '2023-09-17', false),
(43, 2, 9, 5, 'Интересная история', '2023-09-30', true),
(44, 12, 10, 4, 'Керемет туынды!', '2023-09-11', false),
(45, 7, 7, 5, 'Тамаша жазылған!', '2023-09-22', false),
(46, 11, 3, 4, 'Интересная история', '2023-09-16', true);
```
---
#### Задания
##### 1. Простые запросы 
   1. Вывести список всех книг, отсортированных по цене по возрастанию
   2. Вывести клиентов, зарегистрированных после 1 июня 2023 года
   3. Найти все книги жанра "Әдеби проза"
   4. Вывести книги, у которых в наличии больше 30 экземпляров `stocks`
##### 2. Агрегатные функции + GROUP BY
   5. Посчитать количество книг в каждом жанре
   6. Средняя цена книг по каждому издательству
   7. Сколько заказов сделал каждый клиент
   8. Сколько штук каждой книги продано (по `order_items`)
##### 3. Чуть сложнее: агрегаты + фильтры + JOIN'ы
9. Найти автора самой дорогой книги (Имя автора, название книги, прайс, названия жанра)
10. Средний рейтинг каждой книги (если были отзывы)
11. Топ-3 самых популярных авторов по количеству проданных книг
12. Сколько клиентов сделали хотя бы один заказ
13. Средняя сумма заказа по каждому способу оплаты
14. Найти клиентов, которые купили более чем на 5000 (ФИО, и сумма покупки)
15. Найти книги, у которых средний рейтинг выше среднего по всем книгам
